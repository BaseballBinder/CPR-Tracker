{% extends "base.html" %}

{% block content %}
{# Page Header with Action Button #}
{% set page_title = "Sessions" %}
{% set page_subtitle = "Browse and manage CPR sessions" %}
{% set page_actions = [
    {"text": "New Session", "href": "#", "variant": "primary", "icon": "plus", "hx_get": "/partials/session/wizard/step/1", "hx_target": "#modal-container"}
] %}
{% include "components/page_header.html" %}

{# Split sessions by type #}
{% set real_sessions = sessions | selectattr('session_type', 'equalto', 'real_call') | list %}
{% set simulated_sessions = sessions | rejectattr('session_type', 'equalto', 'real_call') | list %}

{# Session Type Tabs #}
<div x-data="{ sessionTab: 'real' }">
    {# Tab Buttons #}
    <div class="flex gap-2 mb-4 page-enter page-d1">
        <button
            @click="sessionTab = 'real'"
            :class="sessionTab === 'real' ? 'bg-[#dc2626] text-white' : 'bg-[#46424e] text-slate-300 hover:bg-[rgba(255,255,255,0.10)]'"
            class="px-4 py-2 text-sm font-medium rounded-lg transition-colors flex items-center gap-2"
        >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
            </svg>
            Real Life
            <span class="px-1.5 py-0.5 text-xs rounded-full" :class="sessionTab === 'real' ? 'bg-red-900/200' : 'bg-[#46424e]'">{{ real_sessions|length }}</span>
        </button>
        <button
            @click="sessionTab = 'simulated'"
            :class="sessionTab === 'simulated' ? 'bg-blue-600 text-white' : 'bg-[#46424e] text-slate-300 hover:bg-[rgba(255,255,255,0.10)]'"
            class="px-4 py-2 text-sm font-medium rounded-lg transition-colors flex items-center gap-2"
        >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
            Simulated
            <span class="px-1.5 py-0.5 text-xs rounded-full" :class="sessionTab === 'simulated' ? 'bg-blue-900/200' : 'bg-[#46424e]'">{{ simulated_sessions|length }}</span>
        </button>
    </div>

    {# ==================== REAL LIFE SESSIONS TAB ==================== #}
    <div x-show="sessionTab === 'real'">
        {# Info Banner #}
        <div class="bg-red-900/20 border border-red-500/30 rounded-xl p-3 mb-4">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-[#dc2626]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
                <p class="text-sm text-red-400">
                    <span class="font-medium">Real-life call sessions</span> from actual emergency responses.
                </p>
            </div>
        </div>

        {# Real Life Sessions Table #}
        <div class="bg-gradient-to-br from-[#3e3a46] via-[#3e3a46] to-[#46424e]/40 rounded-2xl border border-[rgba(255,255,255,0.07)] shadow-sm page-enter page-d2">
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-[#2c2834] text-slate-300 text-left sticky top-0">
                        <tr>
                            <th class="px-4 py-3 font-medium">Date</th>
                            <th class="px-4 py-3 font-medium">Provider</th>
                            <th class="px-4 py-3 font-medium">Status</th>
                            <th class="px-4 py-3 font-medium">Completion</th>
                            <th class="px-4 py-3 font-medium">Depth %</th>
                            <th class="px-4 py-3 font-medium">Rate %</th>
                            <th class="px-4 py-3 font-medium">CCF</th>
                            <th class="px-4 py-3 font-medium">CPM</th>
                            <th class="px-4 py-3 font-medium">Duration</th>
                            <th class="px-4 py-3 font-medium">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-[rgba(255,255,255,0.04)]">
                        {% for session in real_sessions %}
                        <tr class="bg-purple-900/20 hover:bg-[rgba(255,255,255,0.10)] cursor-pointer"
                            hx-get="/partials/sessions/{{ session.id }}/detail"
                            hx-target="#modal-container"
                            hx-swap="innerHTML"
                            title="Click to view session details">
                            <td class="px-4 py-3">
                                <div class="flex items-center gap-2">
                                    <span class="text-slate-200">{{ session.date }}</span>
                                    <div class="flex items-center gap-1">
                                        {% if session.shocks_delivered and session.shocks_delivered > 0 %}
                                        <svg class="w-3.5 h-3.5 text-amber-500" fill="currentColor" viewBox="0 0 16 16" title="Defibrillation: {{ session.shocks_delivered }} shock{{ 's' if session.shocks_delivered != 1 else '' }}">
                                            <path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/>
                                        </svg>
                                        {% endif %}
                                        {% if session.outcome == 'ROSC' %}
                                        <svg class="w-3.5 h-3.5 text-[#16a34a]" fill="currentColor" viewBox="0 0 24 24" title="ROSC Achieved">
                                            <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                                            <path d="M3.5 11h3l1.5-2 1 4 1.5-2h3" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                                        </svg>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            <td class="px-4 py-3 text-slate-200" onclick="event.stopPropagation()">
                                {% if session.provider_id %}
                                <div class="flex flex-col">
                                    <a href="/providers/{{ session.provider_id }}" class="hover:text-[#dc2626] font-medium flex items-center gap-1">
                                        <svg class="w-3 h-3 text-purple-500" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                        </svg>
                                        {{ session.provider_name }}
                                    </a>
                                    {% if session.participants and session.participants|length > 1 %}
                                    <span class="text-xs text-slate-400">+{{ session.participants|length - 1 }} providers</span>
                                    {% endif %}
                                </div>
                                {% else %}
                                <span class="text-slate-400">—</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3">
                                {% if session.status == 'complete' or (session.metrics and not session.status) %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-green-900/30 text-[#16a34a] rounded">Complete</span>
                                {% elif session.status == 'importing' %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-blue-900/30 text-blue-400 rounded">Importing</span>
                                {% elif session.status == 'pending' %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-amber-900/30 text-amber-400 rounded">Pending Provider</span>
                                {% elif session.status == 'failed' %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-red-900/30 text-[#dc2626] rounded">Failed</span>
                                {% else %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-[#46424e] text-slate-300 rounded">{{ session.status or 'Unknown' }}</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3" onclick="event.stopPropagation()">
                                <div class="flex flex-col gap-1">
                                    <label class="flex items-center gap-1.5 cursor-pointer group">
                                        <input type="checkbox"
                                               {% if session.report_sent %}checked{% endif %}
                                               hx-post="/partials/sessions/{{ session.id }}/toggle-completion"
                                               hx-vals='{"field": "report_sent"}'
                                               hx-swap="none"
                                               class="w-3.5 h-3.5 rounded border-[rgba(255,255,255,0.15)] text-[#dc2626] focus:ring-[#dc2626] cursor-pointer">
                                        <span class="text-xs text-slate-300 group-hover:text-slate-100">Report Sent</span>
                                    </label>
                                    <label class="flex items-center gap-1.5 cursor-pointer group">
                                        <input type="checkbox"
                                               {% if session.canroc_complete %}checked{% endif %}
                                               hx-post="/partials/sessions/{{ session.id }}/toggle-completion"
                                               hx-vals='{"field": "canroc_complete"}'
                                               hx-swap="none"
                                               class="w-3.5 h-3.5 rounded border-[rgba(255,255,255,0.15)] text-[#dc2626] focus:ring-[#dc2626] cursor-pointer">
                                        <span class="text-xs text-slate-300 group-hover:text-slate-100">CanROC</span>
                                    </label>
                                    <label class="flex items-center gap-1.5 cursor-pointer group">
                                        <input type="checkbox"
                                               {% if session.ehs_report_complete %}checked{% endif %}
                                               hx-post="/partials/sessions/{{ session.id }}/toggle-completion"
                                               hx-vals='{"field": "ehs_report_complete"}'
                                               hx-swap="none"
                                               class="w-3.5 h-3.5 rounded border-[rgba(255,255,255,0.15)] text-[#dc2626] focus:ring-[#dc2626] cursor-pointer">
                                        <span class="text-xs text-slate-300 group-hover:text-slate-100">EHS Report</span>
                                    </label>
                                </div>
                            </td>
                            <td class="px-4 py-3 text-slate-200">
                                {% if session.metrics and session.metrics.correct_depth_percent is not none %}{{ session.metrics.correct_depth_percent }}%{% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3 text-slate-200">
                                {% if session.metrics and session.metrics.correct_rate_percent is not none %}{{ session.metrics.correct_rate_percent }}%{% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3">
                                {% set ccf = session.metrics.get('compression_fraction') if session.metrics else none %}
                                {% if ccf is not none %}
                                <span class="{% if ccf >= 85 %}text-[#16a34a] font-medium{% elif ccf >= 60 %}text-amber-500{% else %}text-[#dc2626]{% endif %}">{{ ccf }}%</span>
                                {% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3 text-slate-200">
                                {% if session.metrics and session.metrics.compression_rate %}{{ session.metrics.compression_rate }}{% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3 text-slate-200">
                                {% if session.metrics and session.metrics.duration %}{{ session.metrics.duration }}s{% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3" onclick="event.stopPropagation()">
                                <div class="flex items-center gap-2">
                                    {% if session.status == 'failed' %}
                                    <button hx-post="/partials/sessions/{{ session.id }}/retry"
                                            hx-target="closest tr"
                                            hx-swap="outerHTML"
                                            hx-confirm="Retry importing this session?"
                                            class="text-[#dc2626] hover:text-[#b91c1c]"
                                            title="Retry Import">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                    </button>
                                    {% endif %}
                                    <button hx-get="/partials/sessions/{{ session.id }}/detail"
                                            hx-target="#modal-container"
                                            hx-swap="innerHTML"
                                            class="text-slate-400 hover:text-slate-300"
                                            title="View Details">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                    </button>
                                    <button hx-get="/partials/sessions/{{ session.id }}/edit"
                                            hx-target="#modal-container"
                                            hx-swap="innerHTML"
                                            class="text-slate-400 hover:text-slate-300"
                                            title="Edit Session">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </button>
                                    <button hx-delete="/partials/sessions/{{ session.id }}"
                                            hx-confirm="Are you sure you want to delete this session? This action cannot be undone."
                                            hx-target="closest tr"
                                            hx-swap="outerHTML swap:1s"
                                            class="text-slate-400 hover:text-[#dc2626]"
                                            title="Delete Session">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="10" class="px-4 py-12 text-center">
                                {% set empty_icon = "heart" %}
                                {% set empty_title = "No real-life call sessions" %}
                                {% set empty_message = "Add a real-life call session to track emergency response performance" %}
                                {% set empty_cta_text = "Add Session" %}
                                {% set empty_cta_href = "#" %}
                                {% set empty_cta_hx_get = "/partials/session/wizard/step/1" %}
                                {% set empty_cta_hx_target = "#modal-container" %}
                                {% include "components/empty_state.html" %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if real_sessions | length > 0 %}
            <div class="px-4 py-3 border-t border-[rgba(255,255,255,0.07)] flex items-center justify-between">
                <div class="text-sm text-slate-400">
                    Showing <span class="font-medium">{{ real_sessions | length }}</span> real-life session{{ 's' if real_sessions | length != 1 else '' }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    {# ==================== SIMULATED SESSIONS TAB ==================== #}
    <div x-show="sessionTab === 'simulated'">
        {# Info Banner #}
        <div class="bg-blue-900/20 border border-blue-500/30 rounded-xl p-3 mb-4">
            <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                <p class="text-sm text-blue-400">
                    <span class="font-medium">Simulated training sessions</span> for practice and skill development.
                </p>
            </div>
        </div>

        {# Simulated Sessions Table #}
        <div class="bg-gradient-to-br from-[#3e3a46] via-[#3e3a46] to-[#46424e]/40 rounded-2xl border border-[rgba(255,255,255,0.07)] shadow-sm page-enter page-d2">
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-[#2c2834] text-slate-300 text-left sticky top-0">
                        <tr>
                            <th class="px-4 py-3 font-medium">Date</th>
                            <th class="px-4 py-3 font-medium">Provider</th>
                            <th class="px-4 py-3 font-medium">Status</th>
                            <th class="px-4 py-3 font-medium">Completion</th>
                            <th class="px-4 py-3 font-medium">Depth %</th>
                            <th class="px-4 py-3 font-medium">Rate %</th>
                            <th class="px-4 py-3 font-medium">CPM</th>
                            <th class="px-4 py-3 font-medium">Duration</th>
                            <th class="px-4 py-3 font-medium">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-[rgba(255,255,255,0.04)]">
                        {% for session in simulated_sessions %}
                        <tr class="bg-cyan-900/15 hover:bg-[rgba(255,255,255,0.10)] cursor-pointer"
                            hx-get="/partials/sessions/{{ session.id }}/detail"
                            hx-target="#modal-container"
                            hx-swap="innerHTML"
                            title="Click to view session details">
                            <td class="px-4 py-3">
                                <span class="text-slate-200">{{ session.date }}</span>
                            </td>
                            <td class="px-4 py-3 text-slate-200" onclick="event.stopPropagation()">
                                {% if session.provider_id %}
                                <div class="flex flex-col">
                                    <a href="/providers/{{ session.provider_id }}" class="hover:text-blue-600 font-medium">
                                        {{ session.provider_name }}
                                    </a>
                                    {% if session.participants and session.participants|length > 1 %}
                                    <span class="text-xs text-slate-400">+{{ session.participants|length - 1 }} providers</span>
                                    {% endif %}
                                </div>
                                {% else %}
                                <span class="text-slate-400">—</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3">
                                {% if session.status == 'complete' or (session.metrics and not session.status) %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-green-900/30 text-[#16a34a] rounded">Complete</span>
                                {% elif session.status == 'importing' %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-blue-900/30 text-blue-400 rounded">Importing</span>
                                {% elif session.status == 'pending' %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-amber-900/30 text-amber-400 rounded">Pending Provider</span>
                                {% elif session.status == 'failed' %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-red-900/30 text-[#dc2626] rounded">Failed</span>
                                {% else %}
                                <span class="px-2 py-0.5 text-xs font-medium bg-[#46424e] text-slate-300 rounded">{{ session.status or 'Unknown' }}</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3" onclick="event.stopPropagation()">
                                <div class="flex flex-col gap-1">
                                    <label class="flex items-center gap-1.5 cursor-pointer group">
                                        <input type="checkbox"
                                               {% if session.report_sent %}checked{% endif %}
                                               hx-post="/partials/sessions/{{ session.id }}/toggle-completion"
                                               hx-vals='{"field": "report_sent"}'
                                               hx-swap="none"
                                               class="w-3.5 h-3.5 rounded border-[rgba(255,255,255,0.15)] text-blue-600 focus:ring-blue-600 cursor-pointer">
                                        <span class="text-xs text-slate-300 group-hover:text-slate-100">Report Sent</span>
                                    </label>
                                </div>
                            </td>
                            <td class="px-4 py-3 text-slate-200">
                                {% if session.metrics and session.metrics.correct_depth_percent is not none %}{{ session.metrics.correct_depth_percent }}%{% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3 text-slate-200">
                                {% if session.metrics and session.metrics.correct_rate_percent is not none %}{{ session.metrics.correct_rate_percent }}%{% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3 text-slate-200">
                                {% if session.metrics and session.metrics.compression_rate %}{{ session.metrics.compression_rate }}{% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3 text-slate-200">
                                {% if session.metrics and session.metrics.duration %}{{ session.metrics.duration }}s{% else %}—{% endif %}
                            </td>
                            <td class="px-4 py-3" onclick="event.stopPropagation()">
                                <div class="flex items-center gap-2">
                                    <button hx-get="/partials/sessions/{{ session.id }}/detail"
                                            hx-target="#modal-container"
                                            hx-swap="innerHTML"
                                            class="text-slate-400 hover:text-slate-300"
                                            title="View Details">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                    </button>
                                    <button hx-get="/partials/sessions/{{ session.id }}/edit"
                                            hx-target="#modal-container"
                                            hx-swap="innerHTML"
                                            class="text-slate-400 hover:text-slate-300"
                                            title="Edit Session">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </button>
                                    <button hx-delete="/partials/sessions/{{ session.id }}"
                                            hx-confirm="Are you sure you want to delete this session? This action cannot be undone."
                                            hx-target="closest tr"
                                            hx-swap="outerHTML swap:1s"
                                            class="text-slate-400 hover:text-[#dc2626]"
                                            title="Delete Session">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="9" class="px-4 py-12 text-center">
                                {% set empty_icon = "clipboard" %}
                                {% set empty_title = "No simulated training sessions" %}
                                {% set empty_message = "Add simulated sessions to track training performance" %}
                                {% set empty_cta_text = "Add Session" %}
                                {% set empty_cta_href = "#" %}
                                {% set empty_cta_hx_get = "/partials/session/wizard/step/1" %}
                                {% set empty_cta_hx_target = "#modal-container" %}
                                {% include "components/empty_state.html" %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if simulated_sessions | length > 0 %}
            <div class="px-4 py-3 border-t border-[rgba(255,255,255,0.07)] flex items-center justify-between">
                <div class="text-sm text-slate-400">
                    Showing <span class="font-medium">{{ simulated_sessions | length }}</span> simulated session{{ 's' if simulated_sessions | length != 1 else '' }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{# Modal Container for New Session Wizard #}
<div id="modal-container"></div>
{% endblock %}
